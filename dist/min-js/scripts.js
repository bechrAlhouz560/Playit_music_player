!function(){const e=require("jquery"),t=require("react"),a=require("react-dom"),s=require("electron"),n=require("fs"),r=require("path"),l=require("ejs"),o=require("video.js");require("lodash");const c=s.remote,d=c.app,m=c.getCurrentWindow(),u=(m.webContents,c.session.defaultSession,c.session.defaultSession.cookies,[".mp3",".m4a",".mpeg",".wav",".aac"]),g=[".png",".jpg",".jpeg"],p=d.getPath("downloads"),f=(d.getPath("music"),d.getPath("appData")+"/Playit"),v=d.getAppPath(),h=f+"/databases";var y=[],E=[],w=p+"/Voice Records",L=[];n.existsSync(w)||n.mkdirSync(w);const T=e=>new Promise(t=>setTimeout(t,e));var x=require("node-id3"),b=(e(".infos-options .infos .song-infos .song-name"),e(".infos-options .infos .song-infos .song-artist")),C=e(".infos-options .infos .song-cover"),_='<i class="fa fa-pause" aria-hidden="true"></i>',S=e(".infos-options .controls .controls-main"),I=(S.find(".controls--play"),S.find(".controls-previus"),S.find(".controls-next"),e(".time-range span")),M=(e(".infos-options .controls .controls--loop"),e(".infos-options .controls .options--volume"),e("#more-options-dropdown")),k=M.find("#add-to-favorites"),P=M.find("#add-to-a-playlist"),R=(M.find("#edit"),M.find("#delete")),O=M.find("#reveal-in-file-exp");function A(e){return ID3.getAllTags(e)}var D={isMinPlayerActive:!1,curIndex:0,rangeInterval:!1,playerDOM:document.getElementById("player"),currentPlaying:null,song:!1,isRandom:!1,curPlaylist:null,play:(t=!1)=>{if(D.song)t&&(D.song.src=D.currentPlaying);else{var a=new Audio(r.resolve(D.currentPlaying));D.song=a}e(".controls--play, .min-play-btn div").html(_),e(".controls--play, .min-play-btn").addClass("playing"),D.rangeInterval=setInterval(()=>{if(e("#prog")){var t=D.song.currentTime,a=D.song.duration;D.setTimeRange(t,a);var s=100*t/a;e("#range").val(s);var n=e("#range").val();e("#prog").width(n.toString()+"%")}},1e3),e(".song-name").replaceWith('<span class="song-name" id="song-name"><div class="title-loading mb-3"></div></span>'),e("#br-song").hide(),e("#song-artist").html('<div class="artist-loading"></div>'),D.setInfos(),e("#range").on("input",()=>{var t=e("#range").val(),a=D.song.duration,s=a*t/100;D.song.currentTime=s,D.setTimeRange(s,a),e("#prog").width(t.toString()+"%")}),D.song.play().then(()=>{var e=r.resolve(D.currentPlaying);G(e),function(e,t){N.all("SELECT frequent_num FROM musicList WHERE src LIKE ?",[e],(e,a)=>{e?(console.log(e),t(!1)):t(a)})}(e,t=>{if(t)for(freq of t){var a=freq.frequent_num+1;console.log("",a),N.all(`UPDATE musicList SET frequent_num = ${a} \n                            WHERE src like "${e}";`,e=>{e&&alert(e)})}})}).catch(e=>{console.log(e)}),Z(D.currentPlaying,"song",e=>{0==e.length?k.html('<span><i class="fa fa-heart mr-2" aria-hidden="true"></i> add to favorites</span>'):k.html('<span><i class="fa fa-heart mr-2" aria-hidden="true"></i> remove to favs</span>')})},pause:()=>{D.song.pause(),clearInterval(D.rangeInterval),e(".controls--play, .min-play-btn div").html('<i class="fa fa-play" aria-hidden="true"></i>')},loop:()=>{D.song.loop?(D.song.loop=!1,e(".controls--loop,.min-loop-btn").removeClass("controls-active")):(D.song.loop=!0,e(".controls--loop,.min-loop-btn").addClass("controls-active"))},setInfos:()=>{x.read(D.currentPlaying,(e,s)=>{if(e)alert(e);else if(s){if(s.title?D.setTitle(s.title):D.setTitle(),s.image){for(var n="",i=0;i<s.image.imageBuffer.length;i++)n+=String.fromCharCode(s.image.imageBuffer[i]);var l="data:"+s.image.mime.format+";base64,"+window.btoa(n),o=t.createElement("img",{src:l});a.render(o,document.querySelector(".song-cover"))}else D.setCover();s.artist?b.text(s.artist):b.text("Unknown"),N.all("SELECT * FROM musicList WHERE src like ?",[D.currentPlaying],(e,t)=>{e||t[0]&&(t[0].title===s.title&&t[0].artist===s.artist||(console.log("Not Modified yet !"),N.all("UPDATE musicList  SET title = ? , artist = ? WHERE src like ?",[s.title||r.parse(D.song.src).name,s.artist||"Unknown",D.currentPlaying],e=>{e&&console.log(e)})))})}else D.setTitle(),D.setCover(),b.text("Unknown")})},setCover:(s=null)=>{if(s){for(var n="",i=0;i<s.data.length;i++)n+=String.fromCharCode(s.data[i]);var r=(s.format,window.btoa(n)),l=(r=new Blob(s),webkitURL.createObjectURL(r));e(".song-cover").find("img").attr("src",l)}else{var o=t.createElement("img",{src:"./assets/images/cover.png"});a.render(o,document.querySelector(".song-cover"))}},getCover:e=>{return window.webkitURL.createObjectURL(e)},setTimeRange:(e,t)=>{var a=o.formatTime(e,600),s=o.formatTime(t,600),n=a.toString()+" / "+s.toString();return I.text(n),n},setTitle:(t=null)=>{var a;if(((a=t||r.parse(D.song.src)).name?a.name.length:a.length)>30){var s=document.createElement("marquee");s.direction="right";var n=(a.name||a).split("%20"),i="";for(let e of n)i+=e+" ";s.innerHTML=i,s.style.fontSize="19px",s.style.marginRight="15px",e("#br-song").toggle(),s.classList="song-name",e(".song-name").replaceWith(s)}else{n=(a.name||a).split("%20"),i="";for(let e of n)i+=e+" ";var l=document.createElement("span");l.innerText=i,l.classList+="song-name";e("#br-song").show(),e(".song-name").replaceWith(l)}},playlistPlayer:e=>{D.isRandom?D.randomly():D.song.onended=(t=>{t.preventDefault(),e.length-1==D.curIndex?D.curIndex=0:D.curIndex=D.curIndex+1,D.currentPlaying=e[D.curIndex],D.play(!0)})},setPlaylist:(e,t)=>{console.log("setPlaylist param playlist = ",e),"musicList"!=e?(y=z[e],D.curIndex=t,D.currentPlaying=z[e][D.curIndex]):(y=E,D.curIndex=t,D.currentPlaying=y[D.curIndex]),D.play(!0),D.playlistPlayer(y),D.curPlaylist=e},next:()=>{if(D.isRandom){var e=U(y.length-1);D.curIndex=e,D.currentPlaying=y[D.curIndex],D.play(!0)}else y.length-1==D.curIndex?D.curIndex=0:D.curIndex=D.curIndex+1,D.currentPlaying=y[D.curIndex],D.play(!0)},backward:()=>{0!==D.curIndex?D.curIndex=D.curIndex-1:D.curIndex=y.length-1,D.currentPlaying=y[D.curIndex],D.play(!0)},randomly:()=>{D.isRandom=!0,D.song.onended=(e=>{e.preventDefault();var t=U(y.length-1);D.curIndex=t,D.currentPlaying=y[D.curIndex],D.play(!0)})}};function U(e){return Math.floor(Math.random()*e+1)}async function F(e){return await T(500),await n.unlinkSync(e),e}function B(e,t){var a,s=e;if(s.length>t){var n=document.createElement("marquee");n.direction="right";var i=(s.name||s).split("%20"),r="";for(let e of i)r+=e+" ";n.innerHTML=r,n.style.fontSize="19px",n.style.marginRight="15px",n.classList="song-title",a=n}else{i=(s.name||s).split("%20"),r="";for(let e of i)r+=e+" ";var l=document.createElement("span");l.innerText=r,l.classList+="song-title";a=l}return a}e(".controls--play, .min-play-btn").click(function(e){e.preventDefault(),D.song?(D.song.paused?D.play():D.pause(),D.playlistPlayer(y)):(D.currentPlaying=y[0],D.play(!0),D.playlistPlayer(y))}),e(document).ready(function(){document.getElementById("more-options-dropdown").onmouseleave=(()=>{document.onclick=(()=>{e("#more-options-dropdown").slideUp(),e("#more-options").removeClass("controls-active"),document.onclick=null})}),e(".controls--loop,.min-loop-btn").click(e=>{e.preventDefault(),D.loop()}),e(".controls-next,.min-next-btn").click(e=>{e.preventDefault(),D.next()}),e(".controls-previus,.min-previus-btn").click(e=>{e.preventDefault(),D.backward()}),e(".options--volume span").click(t=>{e(".volume-range").toggle(),e(".options--volume span").toggleClass("controls-active")}),e("#volume-inp").on("input",t=>{D.song&&(D.song.volume=e("#volume-inp").val()/100)}),e(".options-minimize").click(()=>{Le(D.currentPlaying,0,0)}),e("#more-options").click(t=>{e("#more-options-dropdown").slideToggle(),e("#more-options").toggleClass("controls-active")}),e(".controls--random").click(t=>{D.isRandom?D.isRandom=!1:(D.isRandom=!0,D.randomly()),e(".controls--random").toggleClass("controls-active")}),k.click(()=>{Z(D.currentPlaying,"song",e=>{0==e.length?Q(D.currentPlaying,"song",e=>{e&&k.html('<i class="fa fa-heart mr-2" aria-hidden="true"></i> Remove From Favs')}):ee(D.currentPlaying,"song",e=>{e&&k.html('<i class="fa fa-heart mr-2" aria-hidden="true"></i> Add to Favorites')})})}),P.click(()=>{me(de.modals.addToPlaylist,{},t=>{e("#main").append(t).ready(()=>{N.all("select * from playlists order by _created DESC",(t,a)=>{if(t)alert(t);else{var s=D.currentPlaying;for(let t of a)N.all("select * from `"+t.title+"`",(a,n)=>{var i=ve.minPl(t.title,n.length,t.cover_src,e=>{V(e,[s]),z[e].push(s);var t=r.parse(s).name;alert(t+" added successfuly")});e(".pl-list").append(i)})}})})})}),R.click(()=>{c.dialog.showMessageBox(m,{title:"Message",message:"are you sure you want to delete this song ?",buttons:["yes","no"]}).then(t=>{var a=D.currentPlaying,s=D.curIndex,n=D.curPlaylist;0==t.response&&(D.next(),F(a).then(t=>{delete z[n][s],e('.music[src="'+a+'"').remove();var i=[];for(let e of plalists[n])void 0!==e&&i.push(e);z[n]=i}).catch(e=>{console.log(e)}))})}),O.click(()=>{var t=D.currentPlaying,a="./assets/images/placeholder.png";x.read(t,(s,n)=>{if(!s){if(n.image){for(var i="",l=0;l<n.image.imageBuffer.length;l++)i+=String.fromCharCode(n.image.imageBuffer[l]);a="data:"+n.image.mime+";base64,"+window.btoa(i)}me(de.modals.editInfos,{title:n.title||r.parse(t).name,artist:n.artist||"Unknown",cover:a},a=>{e("#main").append(a).ready(()=>{e("#close").click(t=>{e(".edit-infos-cont").fadeToggle("fast",()=>{e(".edit-infos-cont").remove()})}),e(".div-img").click(()=>{c.dialog.showOpenDialog(m,{title:"Select a cover for song",properties:["openFile"],filters:["png","jpg","jpeg"]}).then(t=>{t.filePaths&&e(".div-img #cover-img").attr("src",t.filePaths[0])})}),e("#save").click(a=>{e("#save").attr("disabled",!0),setTimeout(()=>{var a=e("#edit-infos-title").val(),s=e("#edit-infos-artist").val(),n=e(".div-img #cover-img").attr("src");fetch(n).then(n=>{n.arrayBuffer().then(n=>{var i=Buffer.from(n);x.update({title:a,artist:s,image:{mime:"image/png",imageBuffer:i}},t,n=>{n?(console.log(n),e("#save").attr("disabled",!1)):N.all("UPDATE musicList SET title = ? , artist = ? WHERE src like ?",[a,s,t],t=>{t?alert(t):e(".edit-infos-cont").fadeToggle("fast",()=>{e(".edit-infos-cont").remove()})})})})})},500)})})})}})})}),document.onkeydown=(t=>{var a;D.isMinPlayerActive||("arrowright"==(a=t.key.toLowerCase())&&D.next(),"arrowleft"==a&&D.backward(),t.ctrlKey&&("s"==(a=t.key.toLowerCase())&&(D.isMinPlayerActive?we():Le(C.find("img").attr("src"),B(D.currentPlaying,15).innerHTML,0,0)),D.isMinPlayerActive||("Space"==a&&(D.song?(D.song.paused?D.play():D.pause(),D.playlistPlayer(y)):D.setPlaylist("musicList",0)),"y"==a&&(D.isRandom?D.isRandom=!1:D.randomly(),e(".controls--random").toggleClass("controls-active")),"l"==a&&D.loop())))}),document.getElementById("player").addEventListener("drop",e=>{e.preventDefault(),e.stopPropagation(),z.dropped=[];for(const t of e.dataTransfer.files)-1!=u.indexOf(r.parse(t.path).ext)&&z.dropped.push(t.path);0!=z.dropped&&D.setPlaylist("dropped",0)}),document.getElementById("player").addEventListener("dragover",e=>{e.preventDefault(),e.stopPropagation()}),c.app.on("play-song",e=>{D.song?(D.song.paused?D.play():D.pause(),D.playlistPlayer(y)):D.setPlaylist("musicList",0)}),c.app.on("next-song",e=>{D.next()}),c.app.on("previous-song",e=>{D.backward()});const H=require("sqlite3").verbose();Number(localStorage.getItem("lastIndex")),localStorage.getItem("autoplay"),localStorage.getItem("paused"),localStorage.getItem("lastTime"),localStorage.getItem("last-playlist");let N,q,W,j,$,z={};function K(e,t){N.all("select * from musicList where src = ?",[e],(e,a)=>{e?(console.log(e),t(!1)):(console.log(a),t(a))})}function V(e,t){for(let a of t)Y(e,a,t=>{t?0==t.length?N.all("INSERT INTO `"+e+"` (song_src) VALUES (?)",[a],e=>{e&&alert(e)}):c.dialog.showMessageBox(m,{title:"Message",message:r.parse(a).name+"already exists in this playlist"}):N.all("INSERT INTO `"+e+"` (song_src) VALUES (?)",[a],e=>{e&&alert(e)})})}function X(e,t){N.all("SELECT * FROM `"+e+"`",(e,a)=>{e?alert(e):t(a)})}function Y(e,t,a){N.all("SELECT song_src FROM `"+e+"` where song_src like ?",[t],(e,t)=>{e?(alert(e),a(!1)):a(t)})}function G(e,t){q.all("SELECT src FROM latest_listened WHERE src like ?",[e],(t,a)=>{t?alert(t):0==a.length?q.run("INSERT INTO latest_listened (src) VALUES (?)",[e],e=>{e&&alert(e)}):q.run("DELETE FROM latest_listened  where src = ?",[e],t=>{t?alert(t):q.run("INSERT INTO latest_listened (src) VALUES (?)",[e],e=>{e&&alert(e)})})})}function J(e,t){N.all("select * from musicList where src like ?",[e],(a,s)=>{a?console.log(a):0!=s.length?t(s):function(e,t){fetch(e).then(a=>{a.blob().then(a=>{ID3.loadTags(e,function(){var a=A(e);t(a||null)},{tags:["title","artist","album","picture"],dataReader:ID3.FileAPIReader(a)})})})}(e,e=>{t(e)})})}function Q(e,t,a){"playlist"==t?W.run("INSERT INTO favorite_playlists (name) VALUES (?)",[e],e=>{a(!e)}):"song"==t&&W.run("INSERT INTO favorite_songs (src) VALUES (?)",[r.resolve(e)],e=>{a(!e)})}function Z(e,t,a){"playlist"==t&&W.all("SELECT * FROM favorite_playlists where name like ?",[e],(e,t)=>{e?(console.log(e),a(!1)):a(t)}),"song"==t&&W.all("SELECT src FROM favorite_songs where src like ?",[e],(e,t)=>{e?(console.log(e),a(!1)):a(t)})}function ee(e,t,a){"playlist"==t&&W.all("DELETE FROM favorite_playlists where name = ?",[e],e=>{e?(console.log(e),a(!1)):a(!0)}),"song"==t&&W.all("DELETE FROM favorite_songs where src = ?",[e],e=>{e?(console.log(e),a(!1)):a(!0)})}function te(e,t,a){"playlist"==e&&W.all("SELECT * FROM favorite_playlists limit ?",[t],(e,t)=>{e?(console.log(e),a(!1)):a(t)}),"song"==e&&W.all("SELECT * FROM favorite_songs ORDER BY added_time DESC LIMIT ?",[t],(e,t)=>{e?(console.log(e),a(!1)):a(t)})}function ae(e,t){"playlist"==e&&W.all("SELECT * FROM favorite_playlists ORDER BY added_time",(e,a)=>{e?(console.log(e),t(!1)):(console.log(a),t(a))}),"song"==e&&W.all("SELECT * FROM favorite_songs ORDER BY added_time",(e,a)=>{e?(console.log(e),t(!1)):t(a)})}async function se(){let e=[],t=await new Promise((e,t)=>{j.all("SELECT * FROM music_folders",(a,s)=>{a?t(a):e(s)})});for await(let s of t)if(n.existsSync(s.path)){let t=await n.readdirSync(s.path);for(let n of t){var a=r.extname(n);if(-1!==u.indexOf(a)){let t=r.resolve(s.path,n);e.push(t)}}}return e}function ne(e){return new Promise((t,a)=>{N.all("UPDATE musicList  SET title = ? , artist = ? WHERE src like ?",[e.title||r.parse(e.src).name,e.artist||"Unknown",e.src],e=>{e?a(e):t(1)})})}async function*ie(){let e=await new Promise((e,t)=>{N.all('SELECT * FROM musicList where artist like "Unknown"',(a,s)=>{a?t(a):e(s)})});for await(let t of e){let e={};await n.existsSync(t.src)&&((e=await x.read(t.src)).src=t.src,await ne(e),await T(600)),yield e}}n.watchFile("dist/css/style.css",{persistent:!1,interval:1},async function(e,t){var a=n.readFileSync("dist/css/style.css").toString();s.remote.getCurrentWindow().webContents.insertCSS(a).then(function(){console.log("style sheets updated !")}).catch(function(e){console.log(e)})}),n.existsSync(h)||n.mkdirSync(h),N=new H.Database(h+"/playlists.db",e=>{e?(c.dialog.showErrorBox("Database Error","error creating a database...it will be errors in the future"),$=!1):($=!0,N.run("CREATE TABLE IF NOT EXISTS playlists (title text,cover_src text,_created timestamp DEFAULT current_timestamp)",e=>{e&&alert(e)}))}),q=new H.Database(h+"/latestListened.db",e=>{e?(c.dialog.showErrorBox("Database Error","error creating a database...it will be errors in the future"),$=!1):q.run("CREATE TABLE IF NOT EXISTS latest_listened (src text,listened_date timestamp DEFAULT current_timestamp)",e=>{e&&alert(e)})}),W=new H.Database(h+"/favorites.db",e=>{e?(c.dialog.showErrorBox("Database Error","error creating a database...it will be errors in the future"),$=!1):($=!0,console.log("areCreatedDatabases"+$),W.run("CREATE TABLE IF NOT EXISTS favorite_songs (src text,added_time timestamp DEFAULT current_timestamp)",e=>{e?alert("error creating favorite_songs table"):console.log("favorite_songs table created")}),W.run("CREATE TABLE IF NOT EXISTS favorite_playlists (name text,added_time timestamp DEFAULT current_timestamp)",e=>{e?alert("error creating favorite_playlists table"):console.log("favorite_playlists table created")}))}),j=new H.Database(h+"/settings.db",e=>{e?(c.dialog.showErrorBox("Database Error","error creating a database...it will be errors in the future"),$=!1):($=!0,console.log($))}),N.all("select * from musicList order by artist",(e,t)=>{if(t)for(let e of t)n.existsSync(e.src)&&-1==E.indexOf(e.src)&&E.push(e.src)}),ae("song",e=>{if(z.favorites=[],e)for(let t of e)z.favorites.push(r.resolve(t.src))}),N.all("SELECT * FROM playlists",(e,t)=>{if(e)console.log(e);else if(0!=t.length)for(let e of t)N.all("SELECT song_src FROM `"+e.title+"`",(t,a)=>{let s=[];for(source of a)s.push(r.resolve(source.song_src));z[e.title]=s})}),m.on("close",e=>{e.preventDefault(),localStorage.setItem("last-playlist",D.curPlaylist),localStorage.setItem("lastIndex",D.curIndex),localStorage.setItem("lastTime",D.song.currentTime),localStorage.setItem("paused",D.song.paused),N.close(),q.close(),W.close(),j.close()}),e(document).ready(()=>{e(".loading").fadeToggle(async()=>{pe.render(),await async function(){var t=await se();console.log("searching for a new songs is running...");let a=0,s=e("body > div.loading > div.msg");s.text("searching for new songs...");for await(let e of t)console.log(e," is running now..."),K(e,function(t){if(0===t.length){let t=r.parse(e).name;console.log(t," not exists !"),N.all("INSERT INTO musicList (src,title,artist) values (?,?,?)",[e,t,"Unknown"],e=>{e?console.log(e):(console.log(t," added to music list !"),a+=1,s.text(a+" new songs found..."))})}})}(),".nav-music"===ce&&fe.showMusicList(),e(".loading").remove()})});var re=(t,a,l,o,d)=>{var u=document.createElement("div"),g=document.createElement("div");g.classList="w-100 h-100 d-inline-flex align-items-center",u.classList="music",u.setAttribute("index",t);var p=document.createElement("div");p.classList="play",p.innerHTML='<i class="fa fa-play-circle mt-2" aria-hidden="true"></i>',g.appendChild(p);var f=document.createElement("div");f.classList="title";var v=B(a,100);f.appendChild(v),g.appendChild(f),g.innerHTML+=`<div class="artist">\n                    <h5 class="p-0 m-0">${o}</h5>\n                </div>`,g.innerHTML+=` <div class="duration">\n                    <h5 class="p-0 m-0">${l}</h5>\n                </div>`;var h=document.createElement("div");h.classList="options";var y,w=document.createElement("span");w.classList="pr-3 add-to-favorites",w.innerHTML='<i class="fa fa-heart" aria-hidden="true"></i>',w.onclick=(e=>{var a;Z(a="musicList"!=d?z[d][t]:E[t],T,e=>{0==e.length?Q(a,"song",e=>{e&&(z.favorites.push(a),w.style.color="#e83c70",w.setAttribute("added-favorite","true"))}):ee(a,"song",e=>{if(e){var t=z.favorites.indexOf(a);-1!=t&&delete z.favorites[t],w.style.color="rgba(216, 216, 216, 0.637)",w.setAttribute("added-favorite","false")}})})});var T="song";y="musicList"!=d?z[d][t]:E[t],u.setAttribute("src",y),Z(y,T,e=>{0!=e.length&&(w.style.color="#e83c70",w.setAttribute("added-favorite","true"))});var x=document.createElement("span");x.classList="pr-3 add-to-playlist",x.innerHTML='<i class="fa fa-plus" aria-hidden="true"></i>',x.onclick=(()=>{me(de.modals.addToPlaylist,{},t=>{e("#main").append(t).ready(()=>{N.all("select * from playlists order by _created DESC",(t,a)=>{if(t)alert(t);else for(let t of a)N.all("select * from `"+t.title+"`",(a,s)=>{var n=ve.minPl(t.title,s.length,t.cover_src,e=>{V(e,[y]),z[e].push(y);var t=r.parse(y).name;alert(t+" added successfuly")});e(".pl-list").append(n)})})})})});var b=document.createElement("span");return b.classList="pr-3 add-to-favorites",b.innerHTML='<i class="fas fa-trash    "></i>',b.onclick=(()=>{var e=D.currentPlaying;c.dialog.showMessageBox(m,{title:"Message",message:"are you sure you want to delete this song ?",buttons:["yes","no"]}).then(a=>{0==a.response&&ee(y,"song",a=>{a&&function(e,t){q.all("DELETE FROM latest_listened WHERE src LIKE ?",[e],(e,a)=>{e?(console.log("there are an error: ",e),t(null)):t(!0)})}(y,a=>{a&&(y===e&&D.next(),F(y).then(()=>{delete z[d][t],u.remove();var e=[];for(let t of z[curPl])void 0!==t&&e.push(t);z[curPl]=e}))})})})}),h.appendChild(w),h.appendChild(x),h.appendChild(b),g.appendChild(h),u.appendChild(g),u.draggable=!0,u.ondragstart=(e=>{e.preventDefault(),s.ipcRenderer.send("ondragstart",r.resolve(y))}),u.onmouseup=(a=>{if(a.preventDefault(),0==a.button&&!a.ctrlKey){var s=a.target.classList;if("title"==s||"song-title"==s)if(n.existsSync(y))D.setPlaylist(d,t);else u.remove(),delete z[d][t],require("lodash").sortBy(),alert("this song is not exists in your directory. maybe removed or replaced.")}if(0==a.button&&a.ctrlKey)if(-1==L.indexOf(u))L.push(u),e(u).toggleClass("music-selected"),console.log("selected !");else{delete L[L.indexOf(u)];var r=[];for(i of L)void 0!==i&&r.push(i);L=r,e(u).toggleClass("music-selected"),console.log("unselected !")}}),e(u).ready(e=>{if(!n.existsSync(y)){let e=z[d][t];delete e,u.remove(),N.all(`DELETE FROM \`${d}\`  where src = ?`,[e],e=>{e&&console.error(e)})}console.log(y," loaded from ",d," with number",t)}),u.artist=l,u},le=(t,a,s=null)=>{var i=document.createElement("div");i.classList="playlist-card";var r=document.createElement("div");r.classList="playlist-img";var l=document.createElement("img"),o=n.existsSync(s);l.src=o?s:"./assets/images/placeholder.png",r.appendChild(l);var d=document.createElement("div");d.classList="playlist-overlay";var u=document.createElement("div");u.classList="buttons";var g=document.createElement("div");g.innerHTML='<i class="fa fa-play" aria-hidden="true"></i>',g.classList="play",g.onclick=(()=>{0!=z[t]&&D.setPlaylist(t,0)});var p=document.createElement("div");p.innerHTML='<i class="fa fa-plus" aria-hidden="true"></i>',p.onclick=(()=>{c.dialog.showOpenDialog(m,{properties:["multiSelections"]}).then(e=>{if(e.filePaths){V(t,e.filePaths);for(let a of e.filePaths)z[t].indexOf(a)||z[t].push(a);console.log("done...playlist")}})}),p.classList="play";var f=document.createElement("div");f.innerHTML='<i class="fa fa-trash" aria-hidden="true"></i>',f.classList="play",f.onclick=(()=>{!function(e){N.run("DELETE FROM playlists WHERE title = ?",[e],t=>{t||N.run(`DROP TABLE IF EXISTS "${e}"`,t=>{if(t)alert(t);else try{delete z[e],ee(e,"playlist",t=>{t?alert(e+" deleted successfully !"):alert("error !")})}catch(e){console.log(e),alert(e)}})})}(t),ve.render()}),u.appendChild(g),u.appendChild(p),u.appendChild(f),d.appendChild(u),r.appendChild(d);var v=document.createElement("div");return v.classList="playlist-infos",v.innerHTML=`<div class="date">\n                             <span>${a}</span>\n                         </div>\n                         <div class="title">\n                             ${t}\n                        </div>`,v.onclick=(e=>{ve.showPlaylist(t,a,s)}),i.appendChild(r),i.appendChild(v),e(r).hover(t=>{e(t.currentTarget).find(".playlist-overlay").fadeToggle()}),i},oe=(e,t,a)=>{var s=document.createElement("div");s.classList="music-folder";var n=document.createElement("div");n.innerHTML='<span class="folder-icon"><i class="fa fa-folder" aria-hidden="true"></i></span>';var i=document.createElement("div");i.classList="infos";var r=`<h4 class="m-0 p-0 folder-name">${e}</h4>`,l=`<h4 class="folder-path">${t}</h4>`;return i.innerHTML=r+"\n"+l,s.appendChild(n),s.appendChild(i),s.onclick=(()=>{a()}),s},ce="home",de={home:v+"/dist/templates/home.html",playlist:v+"/dist/templates/playlists.html",music:v+"/dist/templates/music.html",recorder:v+"/dist/templates/recorder.html",favorites:v+"/dist/templates/favorites.html",modals:{findMusic:v+"/dist/templates/modals/find-music.html",createPlaylist:v+"/dist/templates/modals/create-playlist.html",playlist:v+"/dist/templates/modals/playlist.html",addToPlaylist:v+"/dist/templates/modals/add-to-playlist.html",viewMore:v+"/dist/templates/modals/view-more.html",search:v+"/dist/templates/modals/search.html",editInfos:v+"/dist/templates/modals/edit-info.html"},mini:{noMusic:v+"/dist/templates/mini/no-music.html",folder:v+"/dist/templates/mini/folder.html",dialogBox:v+"/dist/templates/mini/dialog-box.html",min_player:v+"/dist/templates/mini/min-player.html"}};function me(e,t={},a){l.renderFile(e,t,(e,t)=>{e?(alert(e),a(!1)):a(t)})}var ue={home:e(".nav-home"),playlists:e(".nav-playlists"),recorder:e(".nav-recorder"),favorites:e(".nav-favorites"),music:e(".nav-music"),radio:e(".nav-radio"),youtube:e(".nav-youtube")};function ge(t,a){e(ce).removeClass("pi-nav-active"),ce=t,ue[a].addClass("pi-nav-active")}var pe={render:function(){e(ce).removeClass("pi-nav-active"),ce=".nav-home",me(de.home,{message:"you have no music found ! please find your music"},t=>{e("#main").html(t).ready(()=>{e(".view-more-btn").on("click",()=>{q.all("SELECT * FROM latest_listened limit 50",(t,a)=>{t||me(de.modals.viewMore,{title:"Recently listened"},t=>{e("#main").append(t).ready(()=>{e(".close-btn").on("click",()=>{e(".view-more-cont").remove()});var t=document.querySelector(".view-more-body .music-cont");if(0!=a.length){var s="latestListened";z[s]=[];for(let e of a)J(e.src,a=>{var n,i;z[s].push(e.src),a?(i=a.title?a.title:r.parse(e.src).name,n=a.artist||"Unknown"):(i=r.parse(e.src).name,n="Unknown");var l=re(z[s].indexOf(e.src),i,e.listened_date,n,s);t.appendChild(l)})}else me(de.mini.noMusic,{message:"you didn't play any song yet"},e=>{t.innerHTML=e})})})})}),function(e,t){q.all("SELECT * FROM latest_listened order by listened_date DESC limit ?",[e],(e,a)=>{e?(console.log("there are an error: "+e),t(null)):t(a)})}(10,e=>{var t=document.getElementById("list-music"),a=document.createElement("div");if(a.classList="music-cont",t.appendChild(a),a.innerHTML='\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>',0!=e.length){var s="latestListened";z[s]=[];for(let t of e)n.existsSync(t.src)&&x.read(t.src,(e,n)=>{var i,l;z[s].push(t.src),n?(l=n.title?n.title:r.parse(t.src).name,i=n.artist||"Unknown",t.duration):(l=r.parse(t.src).name,i="Unknown"),0!=a.getElementsByClassName("_music-loading").length&&(a.innerHTML="");var o=re(z[s].indexOf(t.src),l,t.listened_date,i,s);a.appendChild(o)})}else me(de.mini.noMusic,{message:"you didn't play any song yet"},e=>{a.innerHTML=e})}),function(e){N.all("SELECT * FROM musicList order by frequent_num DESC limit 10",(t,a)=>{t?(console.log(t),e(!1)):e(a)})}(e=>{var t=document.getElementById("list-music-2"),a=document.createElement("div");if(a.classList="music-cont",t.appendChild(a),a.innerHTML='\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>\n                        <div class="_music-loading"></div>',0!=e.length){var s="mostFriquent";z[s]=[];for(let t of e)if(n.existsSync(t.src)){z[s].push(t.src),0!=a.getElementsByClassName("_music-loading").length&&(a.innerHTML="");var i=re(z[s].indexOf(t.src),t.title||r.parse(t.src).name,t.frequent_num,t.artist,s);a.appendChild(i)}}else me(de.mini.noMusic,{message:"you didn't play any song yet"},e=>{a.innerHTML=e})})})}),ue.home.addClass("pi-nav-active")}},fe={isInitRun:!1,showSongs:async function(e){for await(let a of e){for await(song of a)if(n.existsSync(song.src)){if(-1==E.indexOf(song.src)&&E.push(song.src),".nav-music"==ce){var t=re(E.indexOf(song.src),song.title||r.parse(song.src).name,song.artist,song.added_time.split(" ")[0],"musicList");await t.onload,t.setAttribute("playlist","musicList"),fe.listDOM.push(t),document.getElementsByName(song.artist)[0].appendChild(t)}}else delete y[y.indexOf(song.src)];await T(200)}},initMusic:async()=>{if(0==fe.isInitRun)for await(tag of(fe.isInitRun=!0,ie())){for await(dom of fe.listDOM)dom.getAttribute("src")===tag.src&&(e(dom).find("div .duration h5").text(tag.artist||"Unknown"),tag.title&&e(dom).find("div .title").html(B(tag.title,100)));await T(200)}else console.log("initializing is already started")},search:function(){me(de.modals.search,{placeholder:"Search for Song..."},t=>{e(".main").append(t).ready(()=>{me(de.mini.noMusic,{message:"type what you want to search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')}),e(".srch-input").on("input",t=>{e(".srch-result").html("");var a=t.currentTarget.value;""!=a&&a.length>=4?new Promise((e,t)=>{N.all("SELECT * FROM `musicList` WHERE title LIKE '%"+a+"%' OR artist LIKE '%"+a+"%' AND artist NOT LIKE 'Unknown'",(a,s)=>{a?t(a):e(s)})}).then(t=>{var a=document.createElement("div");if(a.classList="music-cont",e(".srch-result").append(a),0!=t.length)for(result of t){if(n.existsSync(result.src))new Promise(e=>{e(re(E.indexOf(result.src),result.title,"",result.artist,"musicList"))}).then(e=>{a.append(e)})}else me(de.mini.noMusic,{message:"Sorry...we can't find your search"},t=>{e(".srch-result").html(t)})}):""!=a?me(de.mini.noMusic,{message:"type what you want to search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')}):me(de.mini.noMusic,{message:"Sorry...we can't find your search"},t=>{e(".srch-result").html(t)})}),e(".srch-form .close-btn").on("click",()=>{e(".srch-modal-cont").fadeToggle("fast",()=>{e(".srch-modal-cont").remove()})})})})},listDOM:[],Songs:[],Artists:[],showMusicList:()=>{e(ce).removeClass("pi-nav-active"),ce=".nav-music",ue.music.addClass("pi-nav-active"),me(de.music,{},t=>{e("#main").html(t).ready(t=>{if(e(".srch-btn").on("click",()=>{fe.search()}),e(".img-overlay").hide(),e(".song-card").hover(t=>{e(t.currentTarget).find(".img-overlay").toggle()}),e(".find-btn").on("click",e=>{!function(){const e=new c.BrowserWindow({titleBarStyle:"hidden",icon:d.getAppPath()+"/dist/assets/logo/icon.ico",webPreferences:{nodeIntegration:!0,preload:"./preload.js",enableRemoteModule:!0},center:!0,width:1400,height:800});e.setSize(600,650),e.center(),e.resizable=!1,e.loadFile("dist/find-music.html")}()}),fe.listDOM.length!=E.length)fe.listDOM=[],N.all("select * from musicList order by artist",(t,a)=>{if(t)alert(t);else if(0!=a.length){console.log("results.length = ",a.length);var s=10,n=a.length;n<=500&&(s=20,millisc=200),n>500&&n<=1e3&&(s=50),n>1e3&&(s=100);var i=a.length/s;if(0==fe.Songs){var r=0;for(let e=0;e<=s;e++){var l=[];for(let e=0;e<=i;e++)void 0!==a[r]&&(l.push(a[r]),r+=1);0!=l&&fe.Songs.push(l)}}var o=document.createElement("div");o.classList="music-cont",e(".row").append(o);for(let e of a)-1==fe.Artists.indexOf(e.artist)&&fe.Artists.push(e.artist);for(let t of fe.Artists){var c=fe.ArtistHeaders(t);0==document.getElementsByName(t).length&&e(".playlist-list .row").append(c)}console.log("Artists = ",fe.Artists),fe.showSongs(fe.Songs).then(async()=>{await fe.initMusic(),await T(300),fe.listDOM.length=0})}else me(de.mini.noMusic,{message:"Sorry...there are no music to show here. please find your music from your desktop folders"},t=>{if(t){var a=document.createElement("div");a.classList="music-cont",a.innerHTML=t,e(".row").ready(()=>{e(".row").append(a)})}})});else{var a=document.createElement("div");a.classList="music-cont",e(".row").append(a);for(let t of fe.Artists){var s=fe.ArtistHeaders(t);0==document.getElementsByName(t).length&&e(".playlist-list .row").append(s)}for(let t of fe.listDOM)t&&(console.log(t.artist),e(t).ready(()=>{let e=document.getElementsByName(t.artist)[0];e&&e.append(t)}));ue.music.addClass("pi-nav-active")}})})},ArtistHeaders:e=>{var t=document.createElement("div");t.setAttribute("name",e),t.classList="music-cont";var a=document.createElement("div");return a.classList="artist-name",a.innerHTML=e,t.appendChild(a),t}},ve={removePlaylist:()=>{},search:function(){me(de.modals.search,{placeholder:"Search for Playlists..."},t=>{me(de.mini.noMusic,{message:"type what you want to search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')}),e(".main").append(t).ready(()=>{e(".srch-input").on("input",t=>{e(".srch-result").html("");var a=t.currentTarget.value;""!=a?N.all('SELECT * FROM playlists WHERE title like "%'+a+'%"',(t,a)=>{if(t)alert(t);else if(0!=a.length)for(result of a)N.all("SELECT * FROM `"+result.title+"`",(t,a)=>{if(t)console.log(t);else{var s=ve.minPl(result.title,a.length,result.cover_src,()=>{e(".srch-modal-cont").fadeToggle("fast",()=>{e(".srch-modal-cont").remove(),ve.showPlaylist(result.title,result._created,result.cover_src)})});e(".srch-result").append(s)}});else me(de.mini.noMusic,{message:"Sorry...We don't find what you search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')})}):me(de.mini.noMusic,{message:"type what you want to search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')})}),e(".srch-form .close-btn").on("click",()=>{e(".srch-modal-cont").fadeToggle("fast",()=>{e(".srch-modal-cont").remove()})})})})},minPl:function(e,t,a,s){var n=document.createElement("div");n.classList="min-pl mb-3";var i=document.createElement("div");i.classList="min-pl-img";var r=document.createElement("img");r.src=a,i.appendChild(r);var l=document.createElement("div");return l.classList="min-pl-infos",l.innerHTML=`<h4 class="m-0" id="pl-title">${B(e,50).innerHTML}</h4>\n                       <span id="pl-song-count">${t} songs</span>`,n.appendChild(i),n.appendChild(l),n.onclick=(()=>{s(e)}),n},refrechMusic:function(e){X(e,e=>{var t=document.createElement("div");t.classList="list";var a=document.createElement("div");if(a.classList="music-cont",t.appendChild(a),document.getElementsByClassName("pl-body")[0].appendChild(t),e)for(let t of e){var s=document.createElement("div");s.classList="_music-loading",a.appendChild(s),J(t.song_src,e=>{var a,n,i="0:00";e?(n=e.title?e.title:r.parse(t.song_src).name,a=e.artist||"Unknown",t.duration&&(i="0:00")):(n=r.parse(t.song_src).name,a="Unknown",i="0:00"),console.log("current active playlist = ",z[name]),console.log("index is = ",z[name].indexOf(t.song_src));var l=re(z[name].indexOf(t.song_src),n,i,a,name);s.replaceWith(l)})}})},showPlaylist:function(t,a,s){me(de.modals.playlist,{name:t,date:a,cover:s},n=>{e("#main").html(n).ready(()=>{e(".pl-img-overlay").hover(()=>{e(".pl-img-overlay span").fadeToggle(300)}),e(".pl-img-overlay img").on("click",()=>{c.dialog.showOpenDialog(m,{properties:["openFile","createDirectory"]}).then(e=>{if(!e.canceled){var n=e.filePaths[0];-1!=g.indexOf(r.parse(n).ext)?N.run("UPDATE playlists SET cover_src = ? where cover_src = ? ",[n,s],e=>{e?alert("oops ! there are an error please try again later"):(alert(t+"'s cover updated successfuly !"),ve.showPlaylist(t,a,n))}):alert("This file is not an Image file.")}})}),e("#add-song").on("click",n=>{c.dialog.showOpenDialog(m,{properties:["multiSelections"]}).then(n=>{var i=[],l=Number(e(".song-count").text().split(" ")[0]);if(l<=50){for(_path of n.filePaths)-1!=u.indexOf(r.parse(_path))&&i.push(_path);if(0!=i){V(t,i);for(let e of i){if(!(l+i.length<=50)){alert("a playlist should have 50 songs maximum");break}z[t].push(e)}ve.showPlaylist(t,a,s),console.log("done...playlist")}}else alert("a playlist should have 50 songs maximum")})}),Z(t,"playlist",t=>{console.log("pl.length is = ",t.length),0!=t.length?(e("#add-to-favorite").css({backgroundColor:"#e83c70",color:"white"}),e("#add-to-favorite").attr("added-to-favorites","true")):(e("#add-to-favorite").css({backgroundColor:"white",color:"#e83c70"}),e("#add-to-favorite").attr("added-to-favorites","false"))}),e("#add-to-favorite").on("click",a=>{"true"!=e("#add-to-favorite").attr("added-to-favorites")?Q(t,"playlist",t=>{t&&(e("#add-to-favorite").css({backgroundColor:"#e83c70",color:"white"}),e("#add-to-favorite").attr("added-to-favorites","true"))}):W.all("DELETE FROM favorite_playlists WHERE name LIKE ?",[t],t=>{t?(console.log(t),alert("oops ! There are an Error... try again later.")):e("#add-to-favorite").css({backgroundColor:"white",color:"#e83c70"})})}),e("#play-all").on("click",()=>{D.setPlaylist(t,0)}),X(t,a=>{var s=document.createElement("div");s.classList="list";var n=document.createElement("div");n.classList="music-cont",s.appendChild(n),document.getElementsByClassName("pl-body")[0].appendChild(s),z[t]=[],a&&(1==a.length?e(".song-count").text(a.length+" song"):e(".song-count").text(a.length+" songs"),ve.setSongs(t,a,n))})})})},setSongs:async function(e,t,a){z[e]=[];for await(let d of t){if(console.log(e," song = ",d),await n.existsSync(d.song_src)&&(z[e].push(d.song_src),".nav-playlists"===ce)){var s=document.createElement("div");s.classList="_music-loading",a.appendChild(s),await T(200);var i=await x.read(d.song_src),l=i.title||r.parse(d.song_src).name,o=i.artist||"Unknown",c=re(z[e].indexOf(d.song_src),l,"",o,e);s.remove(),a.appendChild(c)}}},render:function(){e(ce).removeClass("pi-nav-active"),ce=".nav-playlists",me(de.playlist,{},t=>{e("#main").html(t).ready(t=>{e(".playlist-card .playlist-img").hover(t=>{e(t.currentTarget).find(".playlist-overlay").fadeToggle()}),e(".create-playlist").on("click",()=>{!function(){var t=[];me(de.modals.createPlaylist,{},a=>{e("body").append(a).ready(()=>{var a=e("#set-cover");e("#remove-cover");e(".browse-file").on("click",()=>{c.dialog.showOpenDialog(m,{properties:["multiSelections"],filters:["mp3","m4a","aac","wav","mpeg"]}).then(a=>{if(a.filePaths&&t.length<=50)for(let n of a.filePaths)if(-1!=u.indexOf(r.parse(n).ext)){if(!(t.length<=50)){alert("playlist should have 50 the maximum");break}if(-1==t.indexOf(n)){var s=oe(r.parse(n).name,n,()=>{});e(".selected-paths").append(s),t.push(n)}}})}),a.on("click",()=>{c.dialog.showOpenDialog(m,{properties:["openFile"],extensions:["png","jpg"]}).then(t=>{-1!=g.indexOf(r.parse(t.filePaths[0]).ext)?e("#pl-cover").attr("src",t.filePaths[0]):alert("this file is not an image file")})}),e("#done").on("click",()=>{if(0!=t.length){var a=e("#pl-cover").attr("src"),s=e("#pl-title").val();""!=s&&function(e,t,a){N.run("INSERT INTO  playlists (title,cover_src) VALUES ('"+e+"','"+t+"')",t=>{t?(alert(t),a(null)):N.run("CREATE TABLE IF NOT EXISTS `"+e+"` (song_src text,added_time timestamp DEFAULT current_timestamp)",e=>{e?(alert(e),a(null)):a(!0)})})}(s,a,a=>{a?(V(s,t),z[s]=t,e(".create-pl-cont").fadeToggle("fast",()=>{e(".create-pl-cont").remove()})):alert("Error Creating your playlist please try again later...")})}else alert("Please add at least one song to create the playlist")}),e("#close-pl").on("click",t=>{e(".create-pl-cont").fadeToggle("fast",()=>{e(".create-pl-cont").remove()})})}),e(".pl-cover").hover(t=>{e(t.currentTarget).find(".pl-overlay").fadeToggle()})})}()}),e(".srch-btn").on("click",()=>{ve.search()}),N.all("select * from playlists order by _created DESC",(e,t)=>{if(e)alert(e);else if(0!=t.length)for(let e of t){var a=e._created.split(" ")[0].replace("-","/"),s=le(e.title,a,e.cover_src),n=document.getElementById("pl-list"),i=document.createElement("div");i.classList="col-3 pl-0 mt-3",i.appendChild(s),n.appendChild(i)}})})}),ue.playlists.addClass("pi-nav-active")}},he={search:function(){me(de.modals.search,{placeholder:"Search for Favorites..."},t=>{e(".main").append(t).ready(()=>{me(de.mini.noMusic,{message:"type what you want to search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')}),e(".srch-input").on("input",t=>{e(".srch-result").html("");var a=document.createElement("div");a.classList+="music-cont",e(".srch-result").append(a);var s=t.currentTarget.value;""!=s&&s.length>=3?N.all('SELECT * FROM musicList where title like "%'+s+'%" OR artist LIKE "%'+s+'%" AND artist NOT LIKE "Unknown"',(t,s)=>{if(0!=s)for(let e of s)W.all('SELECT * FROM favorite_songs where src like "%'+e.src+'%"',(t,s)=>{if(0!=s)for(song of(found=!0,console.log(s),s)){var n=e.artist,i=e.title;console.log(z.favorites.indexOf(e.src)),console.log(e.src);var r=re(z.favorites.indexOf(e.src),i,song.added_time.split(" ")[0],n,"favorites");a.appendChild(r)}});else me(de.mini.noMusic,{message:"Sorry we can't find your search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')})}):(""==s||s.length<=3)&&(""==s?me(de.mini.noMusic,{message:"type what you want to search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')}):s.length<=3&&me(de.mini.noMusic,{message:"Sorry we can't find your search..."},t=>{e(".srch-result").html(t).find(".icon").html('<i class="fa fa-comment    "></i>')}))}),e(".srch-form .close-btn").on("click",()=>{e(".srch-modal-cont").fadeToggle("fast",()=>{e(".srch-modal-cont").remove()})})})})},render:()=>{ge(".nav-favorites","favorites"),me(de.favorites,{},t=>{e("#main").html(t).ready(t=>{z["min-favorites"]=[];e("#srch-btn").on("click",()=>{he.search()}),e("#view-more-songs").on("click",()=>{me(de.modals.viewMore,{title:"Favorite Music"},t=>{e("#main").append(t).ready(()=>{ae("song",e=>{if(0!=e.length)for(let s of e)if(n.existsSync(s.src)){var t=document.querySelector(".view-more-body .music-cont"),a=document.createElement("div");a.classList="_music-loading",t.appendChild(a),t.setAttribute("loading","true"),x.read(s.src,(e,a)=>{z.favorites.indexOf(s.src)||z.favorites.push(s.src);var n,i,l=s.added_time;a||!e?(i=a.title?a.title:r.parse(s.src).name,n=a.artist||"Unknown",s.duration||(l="")):(i=r.parse(s.src).name,n="Unknown",l="",e&&console.log(e));var o=re(z.favorites.indexOf(s.src),i,l,n,"favorites");"true"==t.getAttribute("loading")&&(t.innerHTML="",t.setAttribute("loading","false")),t.appendChild(o)})}})}),e(".close-btn").on("click",()=>{e(".view-more-cont").remove()})})}),te("song",10,e=>{if(z["min-favorites"]=[],0!=e.length){for(let s of e)if(n.existsSync(s.src)){var t=document.getElementById("list-music"),a=document.createElement("div");a.classList="_music-loading",t.appendChild(a),t.setAttribute("loading","true"),x.read(s.src,(e,a)=>{var n,i;e&&console.log(e),z["min-favorites"].push(s.src),a?(i=a.title?a.title:r.parse(s.src).name,n=a.artist||"Unknown"):(i=r.parse(s.src).name,n="Unknown");var l=re(z["min-favorites"].indexOf(s.src),i,s.added_time.split(" ")[0],n,"min-favorites");"true"==t.getAttribute("loading")&&(t.innerHTML="",t.setAttribute("loading","false")),document.getElementById("list-music").appendChild(l)})}}else me(de.mini.noMusic,{message:"you don't add any song to your favorites"},e=>{document.getElementById("list-music").innerHTML=e})}),te("playlist",10,e=>{if(0!=e.length){var t=document.getElementById("pl-list");for(pl of e)N.all("select * from playlists where title like ?",pl.name,(e,a)=>{if(e)alert(e);else if(0!=a.length&&1==a.length){var s=a[0],n=s._created.split(" ")[0].replace("-","/"),i=le(s.title,n,s.cover_src),r=document.createElement("div");r.classList="col-3 pl-0 mt-3",r.appendChild(i),t.appendChild(r)}})}else me(de.mini.noMusic,{message:"you don't add any playlist to your favorites"},e=>{document.getElementById("pl-list").innerHTML=e})})})})}},ye=()=>{var t=n.readdirSync(w);for(_path of(z.records=[],t)){(r.parse(_path).ext="wav")&&z.records.push(w+"/"+_path)}e(".music-cont").html("");for(let t of z.records){var a=z.records,s=re(a.indexOf(t),r.parse(t).name,"","","records");e(".music-cont").append(s)}},Ee=()=>{ge(".nav-recorder","recorder"),me(de.recorder,{},t=>{e("#main").html(t).ready(t=>{var a=n.readdirSync(w);for(_path of(z.records=[],a)){(r.parse(_path).ext="wav")&&z.records.push(w+"/"+_path)}if(e(".rec").on("click",()=>{Te.start(),e(".rec-stop").animate({left:"500px"},200),e(".rec-remove").animate({right:"190px"},200)}),e(".rec-remove").on("click",()=>{Te.recorder.clear(),Te.recording=!1,Te.seconds=0,clearInterval(Te.interval),e(".rec-btn").html('<i class="fa fa-microphone" aria-hidden="true"></i>'),e(".rec").removeClass("recording"),e(".rec-stop").css("left","auto"),e(".rec-remove").css("right","auto")}),e(".rec-stop").on("click",()=>{Te.stop(),e(".rec-stop").css("left","auto"),e(".rec-remove").css("right","auto")}),0!=z.records.length)for(let t of z.records){var s=z.records,i=re(s.indexOf(t),r.parse(t).name,"","","records");e(".music-cont").append(i)}else me(de.mini.noMusic,{message:"you don't have any recorded audio"},t=>{e(".music-cont").html(t)})})})};function we(){m.maximize(),m.resizable=!0,m.menuBarVisible=!0,e("._min-player").remove(),e(".main-body .main").show(),D.setInfos(),D.song.loop?e(".controls--loop").addClass("controls-active"):e(".controls--loop").removeClass("controls-active"),D.isRandom?e(".controls--random").addClass("controls-active"):e(".controls--random").removeClass("controls-active"),D.song.paused||(e(".controls--play, .min-play-btn div").html(_),e(".controls--play, .min-play-btn").addClass("playing")),clearInterval(D.rangeInterval),D.rangeInterval=setInterval(()=>{if(e("#prog")){var t=D.song.currentTime,a=D.song.duration;D.setTimeRange(t,a);var s=100*t/a;e("#range").val(s);var n=e("#range").val();e("#prog").width(n.toString()+"%")}},1e3),D.isMinPlayerActive=!1}function Le(t,a,s,n,i){async function l(t){let a=await x.read(t);var s,n=a.title||r.parse(t).name;a.artist;if(a.image){for(var i="",l=0;l<a.image.imageBuffer.length;l++)i+=String.fromCharCode(a.image.imageBuffer[l]);s="data:"+a.image.mime.format+";base64,"+window.btoa(i)}else s="./assets/images/placeholder.png";e("#min-cover").attr("src",s),e("._min-title").html(B(n,35))}me(de.mini.min_player,{src:t,title:a,artist:s,src:t},t=>{D.rangeInterval&&clearInterval(D.rangeInterval),m.resizable=!1,m.setContentSize(350,350),m.menuBarVisible=!1,e(".main-body .main").hide(),e(".main-body").append(t).ready(()=>{D.isMinPlayerActive=!0,D.song&&(l(D.currentPlaying),D.song.loop&&e("._min-loop").toggleClass("_min-active"),D.isRandom&&e("._min-random").toggleClass("_min-active"),D.song.paused||e("._min-play").html('<i class="fa fa-pause" aria-hidden="true"></i>'),D.rangeInterval=setInterval(()=>{var t=100*D.song.currentTime/D.song.duration;e("#min-range").val(t);var a=e("#min-range").val();e("#min-prog").width(a.toString()+"%")},1e3),D.song.onended=(()=>{if(D.isRandom){var t=U(y.length-1);D.curIndex=t,D.currentPlaying=y[D.curIndex],e("._min-random").toggleClass("_min-active")}else y.length-1==D.curIndex?D.curIndex=0:D.curIndex=D.curIndex+1,D.currentPlaying=y[D.curIndex];D.song.src=D.currentPlaying,D.song.play().then(()=>{G(D.currentPlaying),l(D.currentPlaying)})}),e("#min-range").on("input",()=>{var t=e("#min-range").val();e("#min-prog").width(t.toString()+"%");var a=D.song.duration,s=a*t/100;D.song.currentTime=s,D.setTimeRange(s,a)}),e("._min-next").on("click",()=>{if(D.isRandom){var e=U(y.length-1);D.curIndex=e,D.currentPlaying=y[D.curIndex]}else y.length-1==D.curIndex?D.curIndex=0:D.curIndex=D.curIndex+1,D.currentPlaying=y[D.curIndex];D.song.src=D.currentPlaying,D.song.play().then(()=>{G(D.currentPlaying),l(D.currentPlaying)})}),e("._min-previus").on("click",()=>{0!=D.curIndex?D.curIndex=D.curIndex-1:D.curIndex=y.length,D.currentPlaying=y[D.curIndex],D.song.src=D.currentPlaying,D.song.play().then(()=>{G(D.currentPlaying),l(D.currentPlaying)})}),e("._min-play").on("click",()=>{D.song.paused?(e("._min-play").html('<i class="fa fa-pause" aria-hidden="true"></i>'),D.song.play()):(e("._min-play").html('<i class="fa fa-play" aria-hidden="true"></i>'),D.song.pause())}),e("._min-random").on("click",()=>{D.isRandom?D.isRandom=!1:D.isRandom=!0,e("._min-random").toggleClass("_min-active")}),e("._min-loop").on("click",()=>{D.song.loop?D.song.loop=!1:D.song.loop=!0,e("._min-loop").toggleClass("_min-active")})),e(".top-options span").on("click",()=>{we()})})}),D.isMinPlayerActive=!0}ue.home.on("click",()=>{pe.render()}),ue.playlists.on("click",()=>{ve.render()}),ue.music.on("click",()=>{fe.showMusicList()}),ue.recorder.on("click",()=>{Ee()}),ue.favorites.on("click",()=>{he.render()});var Te={audio_context:null,recorder:null,interval:null,seconds:0,recording:!1,available:!1,timer:e=>{var t=o.formatTime(Te.seconds);e.text(t),Te.interval=setInterval(()=>{Te.seconds=Te.seconds+1;var t=o.formatTime(Te.seconds);e.text(t)},1e3)},init:()=>{try{window.AudioContext=window.AudioContext||window.webkitAudioContext,navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,window.URL=window.URL||window.webkitURL,Te.audio_context=new AudioContext,xe("Audio context set up."),navigator.getUserMedia({audio:!0},()=>{Te.available=!0},e=>{Te.available=!1,console.log(e)}),xe("navigator.getUserMedia "+(navigator.getUserMedia?"available.":"not present!"))}catch(e){alert("No web audio support in this !")}navigator.getUserMedia({audio:!0},Te.startUserMedia,function(e){xe("No live audio input: "+e)})},createDownloadLink:()=>{Te.recorder&&Te.recorder.exportWAV(function(t){var a=URL.createObjectURL(t);t.arrayBuffer().then(t=>{var s=new Uint16Array(t),i=new Audio(a);me(de.mini.dialogBox,{message:"Choose a name for the file:"},t=>{e("#main").append(t).ready(()=>{e(".save-btn").click(()=>{var t=e(".dialog-input").val();""!=t&&n.writeFile(w+"/"+t+".wav",s,{},()=>{e(".dialog-cont").remove(),ye()})}),i.onpause=(()=>{e(".c-play-btn").html('<i class="fa fa-play mr-1" aria-hidden="true"></i> Play')}),e(".cancel-btn").click(()=>{e(".dialog-cont").remove(),i.pause()}),e(".c-play-btn").click(()=>{i.paused?(e(".c-play-btn").html('<i class="fa fa-pause mr-1" aria-hidden="true"></i> pause'),i.play()):(i.pause(),e(".c-play-btn").html('<i class="fa fa-play mr-1" aria-hidden="true"></i> Play'))})})})})})},startUserMedia:e=>{var t=Te.audio_context.createMediaStreamSource(e);xe("Media stream created."),Te.recorder=new Recorder(t),xe("Recorder initialised.")},start:()=>{Te.recording?(Te.recorder&&Te.recorder.stop(),clearInterval(Te.interval),e(".rec-btn").html('<i class="fa fa-pause" aria-hidden="true"></i>'),e(".rec").removeClass("recording"),Te.recording=!1):(Te.recorder&&Te.recorder.record(),Te.timer(e(".rec-btn")),e(".rec").addClass("recording"),xe("Recording..."),Te.recording=!0)},stop:()=>{Te.recorder&&Te.recorder.stop(),xe("Stopped recording."),Te.createDownloadLink(),Te.recorder.clear(),Te.recording=!1,Te.seconds=0,clearInterval(Te.interval),e(".rec-btn").html('<i class="fa fa-microphone" aria-hidden="true"></i>'),e(".rec").removeClass("recording")},pause:()=>{Te.recorder&&Te.recorder.stop(),clearInterval(Te.interval),e(".rec-btn").html('<i class="fa fa-microphone" aria-hidden="true"></i>')}};function xe(e,t){console.log(e)}window.onload=function(){console.log("Start initializing the Recorder..."),Te.init()}}();
